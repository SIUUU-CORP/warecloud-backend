generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id String @default(uuid()) @id
  email String @unique
  password String
  address String?
  createdAt DateTime @db.Timestamptz() @default(now())
  customer Customer?
  vendor Vendor?

  @@index([id, email])
}

model Customer {
  id String @default(uuid()) @id
  fullName String
  phoneNumber String
  userId String @unique
  user User @relation(fields: [userId], references: [id])
  orders Order[]

  @@index([id, userId])
}

model Vendor {
  id String @default(uuid()) @id
  name String
  userId String @unique
  user User @relation(fields: [userId], references: [id])
  items Item[]
  requestSupplies RequestSupply[] @relation("request_supply")
  receiveSupplies RequestSupply[] @relation("receive_supply")

  @@index([id, userId])
}

model Item {
  id String @default(uuid()) @id
  name String
  description String?
  weight Int
  stock Int
  createdAt DateTime @db.Timestamptz() @default(now())
  vendorId String
  vendor Vendor @relation(fields: [vendorId], references: [id])
  orders Order[]
  requestsSupply RequestSupply[]

  @@index([id, vendorId])
}

model Order {
  id String @default(uuid()) @id
  amount Int
  cost Int
  orderStatus OrderStatus
  createdAt DateTime @db.Timestamptz() @default(now())
  updatedAt DateTime @db.Timestamptz() @updatedAt
  customerId String
  customer Customer @relation(fields: [customerId], references: [id])
  itemId String
  item Item @relation(fields: [itemId], references: [id])

  @@index([id, customerId, itemId])
}

enum OrderStatus {
  PENDING
  ACCEPTED
  DELIVERED
}

model RequestSupply {
  id String @default(uuid()) @id
  quantity Int
  requestStatus RequestStatus
  createdAt DateTime @db.Timestamptz() @default(now())
  updatedAt DateTime @db.Timestamptz() @updatedAt
  requestedVendorId String
  requestedVendor Vendor @relation("request_supply", fields: [requestedVendorId], references: [id])
  receivedVendorId String
  receivedVendor Vendor @relation("receive_supply", fields: [receivedVendorId], references: [id])
  itemId String
  item Item @relation(fields: [itemId], references: [id])

  @@index([id, requestedVendorId, receivedVendorId])
}

enum RequestStatus {
  ACCEPTED
  REJECTED
}